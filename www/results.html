<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LiveOL</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" type="text/css" href="css/ratchet.css">
  <!--<link rel="stylesheet" type="text/css" href="css/ratchet-theme-ios.min.css">-->
  <!--<link rel="stylesheet" type="text/css" href="css/ratchet-theme-android.min.css">-->

  <script src='js/jquery.js'></script>
  <script src="js/ratchet.js"></script>
  
  <link rel="stylesheet" type="text/css" href="css/datatables.css">
  <script src="js/datatables.js"></script>

  <!--App-->
  <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body class="loading">
  <header class="bar bar-nav top-header">
    <div class="inner">
      <a href="#!" class="icon icon-left-nav pull-left backbutton" data-ignore='push'></a>
      <a href="help.html" data-transition="slide-in" data-ignore='push'><span class="icon icon-info pull-right"></span></a>
      <h1 id="title" class="title"><span class="compName"></span></h1>
    </div>
  </header>
  
  <section class="content">
  <div id="loader"></div>
  <div class="breadcrumbs">
    <ul>
      <li><a href="index.html" data-ignore='push'>Alla Tävlingar</a></li>
      <li><a href="#!" class="backbutton" data-ignore='push'><span class="compName"></span></a></li>
      <li><span class="className"></span></li>
    </ul>
  </div>
  
  <header class="results-header">
    <div class="autoupdate">
      <p class="label">Automatiska uppdateringar:</p>
      <div class="toggle active-t pull-right" id="toggleInterval">
        <div class="toggle-handle"></div>
      </div>
    </div>

    <h4 class="resultslabel">Resultat för <span class="className"></span></h4>
  </header>

  <!--Switch layout-->
  <div class="segmented-control switchLayout">
    <a class="control-item" href="#regularData">Resultat</a>
    <a class="control-item" onclick="iniTable()" href="#tabularData">Sorterbar Tabell</a>
  </div>
  
  <div id="regularData" class="control-content active">
    <!--Regular data-->
    <div class="card">
      <ul id="results" class="table-view"></ul>
    </div> 
  </div>

  <div id="tabularData" class="control-content">
    <!--Tabular data-->
    <div class="resultsBox">
      <table id="resultsTable" class="tablesorter"> 
        <thead> 
        <tr> 
            <th>#</th> 
            <th>Namn</th> 
            <th>Klubb</th> 
            <th>Resultat</th> 
            <th>Tid efter ledare</th> 
        </tr> 
        </thead> 
        <tbody> </tbody> 
      </table>
    </div>
  </div> 

  </section>

<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="js/app.js"></script>
<script>
  app.initialize();

  //Get required vars from url
  var urlLoop = (window.location.hash.substr(1)).split("&");
  compID = urlLoop[0];
  classID = urlLoop[1];

  //Init classtime, tables and add meta where req
  $(document).ready(function() {
    //Get comp metadata
    getMeta();

    hashUlz(true);

    //If hashUlz fails, get times instead
    getClassTime();

    //Put meta where req and replace URL encoding with space
    $(".className").html(classID.replace(/%20/g, ' '));
    $(".backbutton").attr('href', 'competition.html#' + compID)
  });


  //Toggle auto-update
  var on = true;
  // Our master scheduler:
  setInterval(function() {
      if (on) {
        hashUlz();
      }
  }, 15000);

  //Interval toggle
  $("#toggleInterval").click(function() {
    if (!$(this).hasClass("active-t")) {
      on = !on;
      $(this).removeClass("active-t");
    } else {
      on = true;
      //Run once to check
      hashUlz();
    }
  });

  //Initilize table (hack - write better function)
  var p = 0;
  function iniTable() {
    if (p > 0) {return true} 
    else {
      $('#resultsTable').dataTable( {
        paging: false,
        searching: false
      });
    }
    p = 1;
  }
</script>
</body>
</html>